<html>

<head>
    <style>
        #image {
            height: 70px;
            width: 48px;
            background: url('sprites.png') 0px 0px no-repeat;
            position: absolute;
            left: 48%;
            top: 48%;
        }

        #input {
            display: block;
        }
        /* #body{
            height: 100%;
            width: 100%;
            background: url('https://www.maps.com/media/catalog/product/cache/1/thumbnail/17f82f742ffe127f42dca9de82fb58b1/m/d/mdc1_wor_asia.jpg') 0px 0px no-repeat;
        } */
        #map{
            position: absolute;
        }
    </style>
</head>

<body id="body">
    <img id ="map" src="https://www.maps.com/media/catalog/product/cache/1/thumbnail/17f82f742ffe127f42dca9de82fb58b1/m/d/mdc1_wor_asia.jpg">

    <div id="demo">
        <input type="text" id="input">
        <div id="image"></div>
    </div>
    <script>

        document.getElementById('input').focus();
        
        //movement of map, not character.
        let left;
        let right;
        let up;
        let down;

        let state = 'down';
        
        let rightTO;
        let right2TO;
        let leftTO;
        let left2TO;
        let downTO;
        let down2TO;
        let upTO;
        let up2TO;

        let x = 0;
        let y = 0;

        let xMinusTO;
        let yMinusTO;
        let yPlusTO;
        let xPlusTO;
    
        
        function walk(event) {
            document.getElementById('input').removeEventListener('keydown', walk);
            
            if (event.keyCode === 39) {
                right1();
                moveMapLeft()
                state = 'right';
             
            } if (event.keyCode === 37) {
                left1();
                moveMapRight();
                state = 'left';
            
            } if (event.keyCode === 38) {
                up1();
                moveMapDown();
                state = 'up';
           
            } if (event.keyCode === 40) {
                down1();
                moveMapUp();
                state = 'down';
            }
        }
        function stopWalking(event) {
            console.log('key up!')
            clearTimeout(rightTO);
            clearTimeout(right2TO);
            clearTimeout(leftTO);
            clearTimeout(left2TO);
            clearTimeout(downTO);
            clearTimeout(down2TO);
            clearTimeout(upTO);
            clearTimeout(up2TO);
           
            clearTimeout(yMinusTO);
            clearTimeout(xMinusTO);
            clearTimeout(yPlusTO);
            clearTimeout(xPlusTO);

            left = false;
            up = false;
            down = false;
            right = false;

            document.getElementById('input').addEventListener('keydown', walk);
              
              if  (state === 'up') {
                document.getElementById('image').style.backgroundPosition = "0px -67px";
           
            } if (state === 'right') {
                document.getElementById('image').style.backgroundPosition = "-86px 0px";
           
            } if (state === 'down') {
                document.getElementById('image').style.backgroundPosition = "0px 0px";
           
            } if (state === 'left') {
                document.getElementById('image').style.backgroundPosition = "-86px -67px";
            }

        }
        
        function right1(){
            document.getElementById('image').style.backgroundPosition = "-86px 0px";
                rightTO = setTimeout(right2, 180);
        }
        function right2(){
                document.getElementById('image').style.backgroundPosition = "-126px 0px";
                right2TO = setTimeout(right1, 180);
        }
        function left1(){
                document.getElementById('image').style.backgroundPosition = "-86px -67px";
                leftTO = setTimeout(left2, 180)

        }
        function left2(){
            document.getElementById('image').style.backgroundPosition = "-126px -67px";
            left2TO = setTimeout(left1, 180)
        }
        function down1(){
            document.getElementById('image').style.backgroundPosition = "0px 0px";
            downTO = setTimeout(down2, 180);
        }
        function down2(){
            document.getElementById('image').style.backgroundPosition = "-43px 0px";
            down2TO = setTimeout(down1, 180)
        }
        function up1(){
            document.getElementById('image').style.backgroundPosition = "0px -67px";
            upTO = setTimeout(up2, 180);
        }
        function up2(){
            document.getElementById('image').style.backgroundPosition = "-43px -67px";
            up2TO = setTimeout(up1, 180)
        }

        //background movement
        
        
        function moveMap(){
            document.getElementById('map').style = `left:${x}px; top:${y}px`;
        }
        function moveMapLeft() {
            left = true;
            moveMap();
            decreaseX();
        }
        function moveMapRight() {
            right = true;
            moveMap();
            increaseX();
        }
        function moveMapUp(){
            up = true;
            moveMap()
            decreaseY();
        }
        function moveMapDown(){
            down = true;
            moveMap();
            increaseY();
        }

        function decreaseX() {
            x--;
            if (left) {
                xMinusTO = setTimeout(moveMapLeft, 5)
            }
        }
        function decreaseY(){
            y--;
            if (up){
                yMinusTO = setTimeout(moveMapUp, 5)
            }
        }
        function increaseY(){
            y++;
            if(down){
                yPlusTO = setTimeout(moveMapDown, 5)
            }
        }
        function increaseX(){
            x++;
            if (right) {
                xPlusTO = setTimeout(moveMapRight, 5)
            }
        }
        document.getElementById('input').addEventListener('keydown', walk);
        document.getElementById('input').addEventListener('keyup', stopWalking);

    </script>
</body>

</html>