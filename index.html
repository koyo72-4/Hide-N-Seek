<html>

<head>
    <meta charset="UTF-8">
    <style>
        @font-face {
            font-family: 'orange_kid';
            src: url(orange_kid.ttf) format('truetype'),
            url(orange_kid.woff) format('woff')
        }

        #image {
            height: 70px;
            width: 44px;
            background: url('newSprites.png') 0px 0px no-repeat;
            position: absolute;
            left: 680px;
            top: 400px;
        }

        #paula {
            height: 63px;
            width: 43px;
            background: url('moreSprites.png') 0px 0px no-repeat;
            position: absolute;
            left: 1300px;
            top: 500px;
        }

        #input {
            z-index: -2;
        }

        /* #body{
            height: 100%;
            width: 100%;
            background: url('https://www.maps.com/media/catalog/product/cache/1/thumbnail/17f82f742ffe127f42dca9de82fb58b1/m/d/mdc1_wor_asia.jpg') 0px 0px no-repeat;
        } */

        #map {
            position: absolute;
            z-index: -1;
        }

        body p {
            height: 250px;
            width: 60%;
            font-family: 'orange_kid';
            display: block;
            background-color: black;
            color: beige;
            font-size: 36px;
            padding: 20px;
            border-style: groove;
            border-color: beige;
            border-width: 8px;
            border-radius: 10px;
            letter-spacing: 5px;
            z-index: 1;
        }

        body {
            margin: 0;
            height: 100%;
            overflow: hidden;
        }

        #nameEntry {
            height: 250px;
            width: 60%;
            font-family: 'orange_kid';
            display: block;
            background-color: black;
            color: beige;
            font-size: 36px;
            padding: 20px;
            border-style: groove;
            border-color: beige;
            border-width: 8px;
            border-radius: 10px;
            letter-spacing: 5px;
            z-index: 1;
            display: none;
        }

        #timerDisplay {
            height: 150px;
            width: 150px;
            font-family: 'orange_kid';
            display: block;
            background-color: black;
            color: #f5f5dc;
            font-size: 45px;
            border-style: groove;
            border-color: beige;
            border-width: 8px;
            border-radius: 10px;
            letter-spacing: 5px;
            z-index: 1;
            padding: 0px;
            margin: 0px;
            opacity: .5;
            position: absolute;
            left: 2%;
            top: 80%;
            display: none;
        }

        #timerDisplay h1 {
            text-align: center;
            position: relative;
            left: 5%;
            top: 7%;
            padding: 0px;
            margin: 0px;
        }
    </style>
</head>

<body id="body">
    <img id="map" src="https://www.maps.com/media/catalog/product/cache/1/thumbnail/17f82f742ffe127f42dca9de82fb58b1/m/d/mdc1_wor_asia.jpg">

    <div id="demo">
        <input type="text" id="input">
        <div id="nameEntry">
            <form>
                <span id="nameEntryText"></span>
                <br/>
                <br/>
                <span>Please enter your name.</span>
                <br/>
                <br/>
                <input type="text" id="name">
                <input type="submit">
            </form>
        </div>
        <div id="paula"></div>
        <div id="image"></div>
        <div id="timerDisplay">
            <h1 id="timerDisplayText"></h1>
        </div>
    </div>
    <script>
        // TO DO: disable motion, visible timer, visible score, whistle sound, sound and animation for text

        document.getElementById('input').focus();

        //movement of map, not character.
        let left;
        let right;
        let up;
        let down;

        let state = 'down';

        let rightTO;
        let right2TO;
        let leftTO;
        let left2TO;
        let downTO;
        let down2TO;
        let upTO;
        let up2TO;

        let x = 0;
        let y = 0;

        let xMinusTO;
        let yMinusTO;
        let yPlusTO;
        let xPlusTO;

        let PaulaTO;

        let score = 0;
        let boxStatus = 'closed';

        let textBox;
        let i = 1;

        let randomTop;
        let randomLeft;

        let gameHasBegun = false;

        var music = new Audio('KatiesWaltz.mp3');
        var wind = new Audio('wind.mp3');
        var whistle = new Audio('whistle.mp3');

        let disableMovement = false;
        let time = 60;

        let timerTO;
        let timer2TO;

        let noTimer = true;
        let gameOver = false;



        function walk(event) {
            document.getElementById('input').removeEventListener('keydown', walk);
            // console.log(event.keyCode)
            if (event.keyCode === 39 && !disableMovement) {
                right1();
                moveMapLeft()
                state = 'right';
                if (!gameHasBegun) {
                    wind.play();
                }

            } if (event.keyCode === 37 && !disableMovement) {
                left1();
                moveMapRight();
                state = 'left';

            } if (event.keyCode === 38 && !disableMovement) {
                up1();
                moveMapDown();
                state = 'up';

            } if (event.keyCode === 40 && !disableMovement) {
                down1();
                moveMapUp();
                state = 'down';

            } if (event.keyCode === 13) {
                talkToPaula();

            } if (event.keyCode === 16 && boxStatus === 'open' && !gameOver) {
                endConvo();
            } if (event.keyCode === 81 && boxStatus === 'open' && score > 0) {
                enterScore();
            }

        }
        function stopWalking(event) {
            clearTimeout(rightTO);
            clearTimeout(right2TO);
            clearTimeout(leftTO);
            clearTimeout(left2TO);
            clearTimeout(downTO);
            clearTimeout(down2TO);
            clearTimeout(upTO);
            clearTimeout(up2TO);

            clearTimeout(yMinusTO);
            clearTimeout(xMinusTO);
            clearTimeout(yPlusTO);
            clearTimeout(xPlusTO);

            left = false;
            up = false;
            down = false;
            right = false;

            document.getElementById('input').addEventListener('keydown', walk);

            if (state === 'up') {
                document.getElementById('image').style.backgroundPosition = "-3px -67px";

            } if (state === 'right') {
                document.getElementById('image').style.backgroundPosition = "-86px 0px";

            } if (state === 'down') {
                document.getElementById('image').style.backgroundPosition = "-3px 0px";

            } if (state === 'left') {
                document.getElementById('image').style.backgroundPosition = "-86px -67px";
            }

        }

        function right1() {
            document.getElementById('image').style.backgroundPosition = "-89px 0px";
            rightTO = setTimeout(right2, 180);
        }
        function right2() {
            document.getElementById('image').style.backgroundPosition = "-130px 0px";
            right2TO = setTimeout(right1, 180);
        }

        function left1() {
            document.getElementById('image').style.backgroundPosition = "-89px -67px";
            leftTO = setTimeout(left2, 180)
        }
        function left2() {
            document.getElementById('image').style.backgroundPosition = "-130px -67px";
            left2TO = setTimeout(left1, 180)
        }

        function down1() {
            document.getElementById('image').style.backgroundPosition = "-3px 0px";
            downTO = setTimeout(down2, 180);
        }
        function down2() {
            document.getElementById('image').style.backgroundPosition = "-44px 0px";
            down2TO = setTimeout(down1, 180)
        }

        function up1() {
            document.getElementById('image').style.backgroundPosition = "-3px -67px";
            upTO = setTimeout(up2, 180);
        }
        function up2() {
            document.getElementById('image').style.backgroundPosition = "-44px -67px";
            up2TO = setTimeout(up1, 180)
        }

        //background movement


        function moveMap() {
            document.getElementById('map').style = `left:${x}px; top:${y}px`;
        }
        function moveMapLeft() {
            left = true;
            moveMap();
            decreaseX();
        }
        function moveMapRight() {
            right = true;
            moveMap();
            increaseX();
        }
        function moveMapUp() {
            up = true;
            moveMap()
            decreaseY();
        }
        function moveMapDown() {
            down = true;
            moveMap();
            increaseY();
        }

        function decreaseX() {
            if (!gameHasBegun){
                x = x - 1
                if (left) {
                    xMinusTO = setTimeout(moveMapLeft, 10)
                }
            } else {
                x = x - 4;
                if (left) {
                    xMinusTO = setTimeout(moveMapLeft, 5)
                }
            }
        }
        function decreaseY() {
            if (!gameHasBegun){
                y = y - 1
                if (up) {
                    yMinusTO = setTimeout(moveMapUp, 10)
                }
            } else {
                y = y - 4;
                if (up) {
                    yMinusTO = setTimeout(moveMapUp, 5)
                }
            }
        }
        function increaseY() {
            if (!gameHasBegun){
            y = y + 1
            if (down) {
                    yPlusTO = setTimeout(moveMapDown, 10)
                }
            } else {
                y = y + 4;
                if (down) {
                    yPlusTO = setTimeout(moveMapDown, 5)
                }
            }
        }
        function increaseX() {
            if (!gameHasBegun){
                x = x + 1 
                if (right) {
                    xPlusTO = setTimeout(moveMapRight, 10)
                }
            } else {
                x = x + 4;
                if (right) {
                    xPlusTO = setTimeout(moveMapRight, 5)
                }
            }
        }

        document.getElementById('input').addEventListener('keydown', walk);
        document.getElementById('input').addEventListener('keyup', stopWalking);

        //Paula

        function animatePaula1() {
            document.getElementById('paula').style.backgroundPosition = "0px 0px";
            setTimeout(animatePaula2, 540)

        }
        function animatePaula2() {
            document.getElementById('paula').style.backgroundPosition = "-43px 0px";
            setTimeout(animatePaula1, 540)
        }
        function positionPaula() {
            if (gameHasBegun === false) {
                document.getElementById('paula').style.left = `${1300 + x}px`;
                document.getElementById('paula').style.top = `${500 + y}px`;
                paulaTO = setTimeout(positionPaula, 5)

            } else if (gameHasBegun === true) {
                document.getElementById('paula').style.left = `${randomLeft + x}px`;
                document.getElementById('paula').style.top = `${randomTop + y}px`;
                paulaTO = setTimeout(positionPaula, 5)
            }
        }

        function talkToPaula() {
            if
            (document.getElementById('paula').style.left.slice(0, -2) > 600
            &&
            document.getElementById('paula').style.left.slice(0, -2) < 760
            &&
            document.getElementById('paula').style.top.slice(0, -2) > 320
            &&
            document.getElementById('paula').style.top.slice(0, -2) < 480
            &&
            boxStatus === 'closed') {
                if (gameHasBegun === false) {
                    boxStatus = 'open'

                    textBox = document.createElement('p');

                    var linebreak1 = document.createElement('br');
                    var linebreak2 = document.createElement('br');
                    var linebreak3 = document.createElement('br');
                    var linebreak4 = document.createElement('br');

                    var text = document.createTextNode("Velkommen til Grønland!");
                    textBox.appendChild(text);
                    textBox.appendChild(linebreak1);
                    textBox.appendChild(linebreak2);
                    var text2 = document.createTextNode("Let's play hide and seek! I will give you 1 point each time you find me. Hee hee!");
                    textBox.appendChild(text2);
                    textBox.appendChild(linebreak3)
                    textBox.appendChild(linebreak4)
                    var text3 = document.createTextNode("Press 'SHIFT' to play.");
                    textBox.appendChild(text3);
                    document.body.appendChild(textBox);

                } else if (gameHasBegun === true) {

                    score = score + 1;
                    boxStatus = 'open';
                    // gameHasBegun = false;
                    stopMusic();
                    textBox = document.createElement('p');

                    var linebreak1 = document.createElement('br');
                    var linebreak2 = document.createElement('br');
                    var linebreak3 = document.createElement('br');
                    var linebreak4 = document.createElement('br');

                    var text = document.createTextNode("Golly! You sure are good at Hide and Seek!");
                    textBox.appendChild(text);
                    textBox.appendChild(linebreak1);
                    textBox.appendChild(linebreak2);
                    var text2 = document.createTextNode(`Your score is now ${score}. Good job, hee hee!`);
                    textBox.appendChild(text2);
                    textBox.appendChild(linebreak3)
                    textBox.appendChild(linebreak4)
                    var text3 = document.createTextNode("Press 'SHIFT' to play again, or 'Q' to quit and post your score to the leaderboard.");
                    textBox.appendChild(text3);
                    document.body.appendChild(textBox);
                    stopTimer();
                }
            }
        }

        function endConvo() {
            textBox.remove();
            boxStatus = 'closed'
            startGame();
        }
        function startGame() {
            clearTimeout(paulaTO);
            paulaRunsAway();
            playMusic();
            gameHasBegun = true;
            noTimer = false;
            timer();
        }
        function paulaRunsAway() {
            if (!randomTop) {
                document.getElementById('paula').style.top = `${500 + y + i}px`;
                setTimeout(increaseI, 20);
            } else {
                document.getElementById('paula').style.top = `${randomTop + y + i}px`;
                setTimeout(increaseI, 20);
            }
        }
        function increaseI() {
            if (i < 1000) {
                i = i + 10
                paulaRunsAway();
            } else {
                i = 1;
                setTimeout(sheReappearsElsewhere, 100)
            }
        }
        function playMusic() {
            music.play()
            wind.pause()
        }
        function stopMusic() {
            music.pause()
            wind.play()
        }
        function sheReappearsElsewhere() {
            //topleft: (601,365) bottomleft: (601, -4340), bottomright: (-6469, -4340), topright: (-6469, 365)
            randomTop = Math.floor(Math.random() * (365 - 4340 + 1)) + 4340;
            randomLeft = Math.floor(Math.random() * (601 - 6469 + 1)) + 6469;
            document.getElementById('paula').style.top = randomTop + 'px';
            document.getElementById('paula').style.left = randomLeft + 'px';
            positionPaula()
        }
        function enterScore() {
            textBox.remove();
            document.getElementById('nameEntry').style.display = 'block';
            document.getElementById('nameEntryText').textContent = `Your score was ${score}. Nice!`
        }
        function timer() {
            if (!noTimer) {
            document.getElementById('timerDisplay').style.display = 'block';
            document.getElementById('timerDisplayText').textContent = time;
            var timerTO = setTimeout(updateTimer, 1000)
            }

        }
        function updateTimer() {
            if (time > 0) {
                time = time - 1
                timer()
            } else {
                document.getElementById('timerDisplay').style.display = 'none';
                disableMovement = true;
                whistle.play();
                time = 60;
                stopMusic();
                timeIsUp()
            }
        }
        function stopTimer(){
            clearTimeout(timerTO);
            console.log('stopTimer!')
            document.getElementById('timerDisplay').style.display = 'none';
            time = 60;
            clearTimeout(timerTO);
            noTimer = true;
        }
        function timeIsUp(){
                    gameOver = true;
                    boxStatus = 'open';
                    // gameHasBegun = false;
                    stopMusic();
                    textBox = document.createElement('p');

                    var linebreak1 = document.createElement('br');
                    var linebreak2 = document.createElement('br');
                    var linebreak3 = document.createElement('br');
                    var linebreak4 = document.createElement('br');

                    if (score > 0) {
                    
                    var text = document.createTextNode("Time is up! I'm a pretty good hider, right?");
                    textBox.appendChild(text);
                    textBox.appendChild(linebreak1);
                    textBox.appendChild(linebreak2);
                    var text2 = document.createTextNode(`Your score was ${score}. Good job, hee hee!`);
                    textBox.appendChild(text2);
                    textBox.appendChild(linebreak3)
                    textBox.appendChild(linebreak4)
                    var text3 = document.createTextNode("Press 'Q' to quit and post your score to the leaderboard.");
                    textBox.appendChild(text3);
                    document.body.appendChild(textBox);
                    stopTimer();
                    
                    } else {

                    var text = document.createTextNode("Time is up! I'm a pretty good hider, right?");
                    textBox.appendChild(text);
                    textBox.appendChild(linebreak1);
                    textBox.appendChild(linebreak2);
                    var text2 = document.createTextNode(`Your score was ${score}. You couldn't even find me once? hee hee!`);
                    textBox.appendChild(text2);
                    textBox.appendChild(linebreak3)
                    textBox.appendChild(linebreak4)
                    var text3 = document.createTextNode("Game Over. Refresh the page to try again.");
                    textBox.appendChild(text3);
                    document.body.appendChild(textBox);
                    stopTimer();
                    }
        }

        animatePaula1();
        positionPaula();
    </script>
</body>

</html>